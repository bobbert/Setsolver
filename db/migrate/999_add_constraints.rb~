# db/migrate/6_add_foreign_key.rb
class AddConstraints < ActiveRecord::Migration
  # method to create SQL foreign key constraint from table names in singular form
  def create_fk( parent, child )
    'ALTER TABLE ' + parent.pluralize + ' ADD CONSTRAINT ' + child + '_id_fkey ' +
    'FOREIGN KEY (' + child + '_id) REFERENCES ' + child.pluralize + 's (id);'
  end
  # method to drop SQL foreign key constraint from table names in singular form
  def drop_fk( parent, child )
    'ALTER TABLE ' + parent.pluralize + ' DROP CONSTRAINT ' + child + '_id_fkey;'
  end
  
  
  def self.up
    ['number','shading','color','shape'].each do |tbl_nm|
      execute create_fk( 'card', tbl_nm )
    end
    # association table FK's
    execute create_fk( 'cards_deck', 'card' )
    execute create_fk( 'cards_deck', 'deck' )
    execute create_fk( 'cards_game', 'card' )
    execute create_fk( 'cards_game', 'game' )
  end

  def self.down
    ['number','shading','color','shape'].each do |tbl_nm|
      execute drop_fk( 'card', tbl_nm )
    end
    # association table FK's
    execute drop_fk( 'cards_deck', 'card' )
    execute drop_fk( 'cards_deck', 'deck' )
    execute drop_fk( 'cards_game', 'card' )
    execute drop_fk( 'cards_game', 'game' )
  end
end